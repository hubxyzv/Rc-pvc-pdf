async function generateRC() {
    const v = document.getElementById('vNo').value.toUpperCase().trim();
    if(!v) return alert("Vehicle Number daalein!");
    
    document.getElementById('loader').style.display = "block";
    document.getElementById('pvc').style.display = "none";

    try {
        const res = await fetch(`/fetch-rc?vNo=${v}`);
        const data = await res.json();
        
        // --- DATA PATH FIX ---
        // API response ke structure ke hisaab se mapping
        const d = data.rc_chudai.data[0]; 
        const basic = data.basic_vehicle_info;
        const docs = data.registration_documents;
        const owner = data.owner_details;

        // FRONT CARD PE DATA DAALNA
        document.getElementById('f-class').innerText = d.vh_class || "VEHICLE";
        document.getElementById('f-reg').innerText = v;
        document.getElementById('f-maker').innerText = d.maker || "--";
        document.getElementById('f-model').innerText = d.vh_maker_model || "--";
        document.getElementById('f-fuel').innerText = d.fuel_type || "--";
        document.getElementById('f-mfg').innerText = basic.manufacturing_year || "--";
        document.getElementById('f-auth').innerText = d.rto ? d.rto.split(',')[0] : "--";
        
        // QR CODE
        document.getElementById('qr').src = `https://api.qrserver.com/v1/create-qr-code/?data=${v}`;

        // BACK CARD PE DATA DAALNA
        document.getElementById('b-reg').innerText = v;
        document.getElementById('b-date').innerText = docs.registration_date || "--";
        document.getElementById('b-name').innerText = owner.owner_name || "--";
        document.getElementById('b-swd').innerText = d.father_name || "--";
        document.getElementById('b-addr').innerText = owner.permanent_address || "--";
        document.getElementById('b-eng').innerText = docs.engine_no || "--";
        document.getElementById('b-cha').innerText = docs.chassis_no || "--";

        // SAB KUCH DIKHAYEIN
        document.getElementById('pvc').style.display = "flex";
        document.getElementById('pBtn').style.display = "block";
    } catch(e) {
        console.error(e);
        alert("API Response Error: Check Render Logs for details.");
    } finally {
        document.getElementById('loader').style.display = "none";
    }
}
